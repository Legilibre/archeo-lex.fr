<svelte:head>
	<title>{ucfirst(identifiant)}</title>
</svelte:head>

<div id="texte" class="centre">

<h1>{ucfirst(identifiant)}</h1>

<p>&lt; <a rel="prefetch" href="{base}/eli/{nature}">{ucfirst(nature)}s</a></p>

<!-- I cannot affirm for now that the code is in force (or abrogated), see https://github.com/Legilibre/Archeo-Lex/issues/62 -->
<p>{#if etat === 'vigueur-future'}<span class="{nature}">{ucfirst(nature)} en {etat.replace('-', ' ')}{#if etat === 'vigueur'}&nbsp;(ou abrogé){/if}</span>&nbsp;;&nbsp;{/if}{versions.length} version{#if versions.length !== 1}s{/if}</p>

<ul>
{#each versions as item}
<li><a href="{base}/eli/{nature}/{identifiant}/lc/texte/{item.date.replace(/-/g, '')}">{#if item.date === '2222-02-22'}date indéterminée{:else}{ISO86012dateFR(item.date)}{/if}</a> <a href="{base}/diff/eli/{nature}/{identifiant}/lc/texte/{item.date.replace(/-/g, '')}">(diff)</a> {#if etat === 'vigueur-future' || item.etat == 'vigueur-future'}<span class="vigueur-future">&nbsp;(vigueur future)</span>{/if}</li>
{/each}
</ul>

</div>

<script>

	import config from "../../../config";
	import l10n from '../../../lib/l10n';

	export default {
		async preload({ params }) {
			const { nature, identifiant } = params,
			      res = await this.fetch(`eli/${nature}/${identifiant}.json`),
			      jsonlog = await res.json();

			return {
				base: config.base,
				nature,
				identifiant,
				etat: jsonlog.etat,
				versions: jsonlog.versions
			}
		},

		helpers: {
			ISO86012dateFR(iso8601) {
				const r = /^([0-9]{4})-([0-9]{2})-([0-9]{2})$/.exec(iso8601);
				return r ? (r[3][0] == '0' ? r[3][1] : r[3]) + (r[3] == '01' ? 'er' : '') + ' ' + l10n.moisFR['fr'][r[2]] + ' ' + r[1] : '';
			},
			ucfirst(s) {
				s = s.trim().replace(/_/g, ' ');
				return s.substring(0, 1).toUpperCase() + s.substring(1);
			}
		}
	};
</script>
