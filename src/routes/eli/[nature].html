<svelte:head>
	<title>{ucfirst(nature)}s</title>
</svelte:head>

<h1>{ucfirst(nature)}s</h1>

<span>{Object.keys(texts).length} {nature}{#if Object.keys(texts).length != '1'}s{/if} : <label><input type="checkbox" bind:checked=vigueur />en vigueur</label> • <label><input type="checkbox" bind:checked=vigueur_future />en vigueur future</label></span>

<ul>
{#each Object.entries(texts) as [text, metadata]}
<li><a href="{base}/eli/{nature}/{text}">{ucfirst(text)}</a>{#if !('texte' in metadata)}<span class="vigueur-future">&nbsp;(vigueur future)</span>{/if}</li>
{/each}
</ul>

<script>

	import { base } from "../../config";

	export default {
		async preload({ params }) {
			const { nature } = params,
			      res = await this.fetch(`eli/${nature}.json`),
			      jsontexts = await res.json();

			if (res.status === 200) {
				return { base, nature, jsontexts };
			} else {
				this.error(res.status, jsontexts.message);
			}
		},

		data() {
			return {
				vigueur: true,
				vigueur_future: false
			}
		},

		computed: {
			texts: ({ jsontexts, vigueur, vigueur_future }) => {
				let item, texts = JSON.parse(JSON.stringify(jsontexts));
				for( item in texts ) {
					if( (!vigueur_future && !('texte' in texts[item])) ||
					    (!vigueur && 'texte' in texts[item])
					) {
						delete texts[item];
					}
				}
				return texts;
			}
		},

		helpers: {
			ucfirst(s) {
				s = s.trim().replace(/_/g, ' ');
				return s.substring(0, 1).toUpperCase() + s.substring(1);
			}
		}
	};
</script>
